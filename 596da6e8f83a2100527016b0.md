# 5分钟学会矩阵求导

    最近一些读者反映在阅读机器学习、深度学习相关的文章的时候，常会被里边的矩阵算法推导弄得蒙圈，求导数简单，但是矩阵求导不容易。这两天量化侠在网上找了不少关于矩阵求导的求解资料，仔细研究了下矩阵求导过程，发现或多或少没有将矩阵求导的细节和要领交代清楚，于是写下这篇笔记，帮助大家算法入门。
    
在数学中，矩阵运算(主要指的是向量，标量，矩阵之间的相互求导运算)是进行多变量运算的专门符号，特别是在矩阵空间上。矩阵运算将一个方程对多个变量或者是一个多变量方程对一个变量的求导表示成一个简单的符号。 这很大程度上**简化了矩阵求导的书写过程**，可将其应用在求解多元函数极值以及微分方程系统的操作上。 

首先，我们来看一个简单的例子：向量对标量求导。显然，计算一个列向量
![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/7585b998-6b7c-11e7-bb11-0242ac140002)
对一个标量*x*求导可以写成以下形式
![(1)](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/9b5f454e-6b7c-11e7-bb11-0242ac140002)
这个约定是否是唯一呢？假如y为标量，![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/af307516-6b7c-11e7-ab56-0242ac140002)*y*对**x**的导数应该如何书写呢？有人可能会说，显然应该这样推导：
![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/f86219f6-6b7c-11e7-bb11-0242ac140002)
可是有人也会发现，一些机器学习的公式推导可能采取下面这种推导方式：
![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/28435126-6b7d-11e7-bb11-0242ac140002)
那究竟哪一种表达方式是正确的呢？其实这里没有标准答案，两种不同的表达方式只是遵循不同的约定。同样回头看看向量对标量的求导公式，我们也会发现同样的问题，它也可能存在另一种表达方式。国际上对两种表达方式有定义，即**分子布局**（numerator layout），**分母布局**（denominator layout）。观察以上公式我们可以发现，分子布局（numerator layout）的约定为**分子不转置而分母转置**，反之，分母布局（denominator layout）的约定则是分子转置而分子不发生转置，因此，我们只需记住前者的约定即可理解矩阵求导的位置问题。
接下来，我们主要遵循分子布局约定进行公式推导。我们来看一个向量对向量求导的例子：计算一个向量![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/48a69c84-6b7d-11e7-bb11-0242ac140002)对另一个向量![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/54d02f02-6b7d-11e7-ab56-0242ac140002)求导可以写成以下形式的雅可比矩阵（Jacobi matrix）
  ![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/67ea769c-6b7d-11e7-bb11-0242ac140002)
以此类推，我们可以得到标量*y*对矩阵**X**的求导公式，
    ![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/7d21cfce-6b7d-11e7-bb11-0242ac140002)
下边我们给出一个案例，现在有一个标量，可以表达为以下形式
    ![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/a666542c-6b7d-11e7-ab56-0242ac140002)
其中![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/b466fa22-6b7d-11e7-ab56-0242ac140002),矩阵**A**不依赖于**x**，则
    ![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/76bed3e2-6b7e-11e7-ab56-0242ac140002)
证明：
由于标量，因此  
    ![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/c8632ffa-6b7d-11e7-ab56-0242ac140002)
从以上分子布局约定的求导，我们可以注意到，对于最后一项**x**求导，不改变原有计算式，这里采取分步求导，求取标量的导数。第一项**x**的导数，通过上式的导数来求取，因此可以得到下列算式：
    ![图片注释](http://storage-uqer.datayes.com/5832ba30228e5ba297a91682/ba032c52-6b7e-11e7-ab56-0242ac140002)
主要参考资源：
https://en.wikipedia.org/wiki/Matrix_calculus

    
    
  
  
  
  




