# 当策略用到股权登记日时，小心存在未来函数

    在检查策略时股权登记日存在未来函数的情况，截图如下：策略2017.1.1-2017.10.29，每月调仓，当策略运行到2017.1.26时，为股权登记日排序后，发现已经获取了2017.8.17的股票股权登记日，而且下面的还获取了2017.8.17当日的收盘价。由此判断存在未来函数，具体对策略结果造成多大影响还不清楚。社区中许多涉及股权登记日的策略有存在这个问题的可能，可以自行验证。
![![图片注释](http://storage-uqer.datayes.com/5874e6e023a7d60051a36d00/93d2e9b8-bd82-11e7-9497-0242ac140002)](http://storage-uqer.datayes.com/5874e6e023a7d60051a36d00/93d2e9b8-bd82-11e7-9497-0242ac140002)
![图片注释](http://storage-uqer.datayes.com/5874e6e023a7d60051a36d00/9c9d71bc-bd82-11e7-95fa-0242ac140002)
解决办法如下：
    转换股权登记日格式，选出小于account.previous_date（帐户当前日期的前一个交易日），这个是为了避免获取的股权登记日的收盘次出现未来函数。
运行部分代码和输出结果图片如下：
![图片注释](http://storage-uqer.datayes.com/5874e6e023a7d60051a36d00/091f6412-bd83-11e7-9497-0242ac140002)
![图片注释](http://storage-uqer.datayes.com/5874e6e023a7d60051a36d00/111ad322-bd83-11e7-95fa-0242ac140002)



