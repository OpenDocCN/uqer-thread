# 基于样本迁移学习的沪深300股票选股择时

作为一名不懂股票的算法狗，对股票数据心仪已久，一直没有一个好的切入点，而且限于自身经验和知识的限制，一直没有敢于大胆的尝试。正好由于最近疫情的影响假期延长，这个春节我尝试了几种我认为有希望有效果的算法方案。下面就比较成功的一种做一个简要的介绍。

从大的方面来讲，做一个完整的股票策略，和我们做一个风控模型架构，从引入授信到贷中管理的整个过程非常像，当然没有贷后的事情。类比来看，所以我所欠缺的主要是策略经验，尤其是大的规则经验，如何设计一些条件先选定一个相对稳定的样本池。所以我偷懒，只选取沪深300的300只股票，变量我只选取我认为比较好理解的30+基础变量，然后对这三十多个变量进行衍生，衍生了不到100个衍生变量，一会具体讲衍生逻辑。

整个测试的过程当中，犯了很多错误，主要是对股票数据和策略的不了解。作为一个数据老鸟，把我能注意的问题都加倍小心，开始鸡贼的以为躲过了过拟合和数据穿越，但结果还是太年轻。头三天的初版模型，目标是预测股票为来一个月，3个月和一年的涨跌，效果出奇的好，几乎没费什么力气。我也一度沾沾自喜，怀疑人生。反复检测能够出现的问题，数据表面上看确实没有穿越的问题，由于我预测的周期也比较长，在交易日内交易的时点问题也不大，回测框架是自带的，买不到的股票回测也不会成交，回测结果从13年到19年都效果极好。但是其实犯了一个很低级的错误，我选择的初始股票池是沪深300昨天的股票，这些股票都是经过历史筛选的，历史上比较差的股票已经不能编入现在的指数。

所以推到重来，选取沪深300指数历史上某个历史时点的股票，预测这300只股票未来的涨跌，和指数对比，长期来讲，之前的模型框架根本跑不赢指数，除非加很多人的经验和知识，但是这些是我不具备的。

因此我选择了对基础数据的剔除和衍生，把我认为不稳定的变量都剔除了，剩了35个变量，进行衍生。衍生的逻辑来源于两个，一个是CAPM模型和行业内比较。意思就是说，把所有股票的数据按照时间和行业两个维度归一化。举个例子，两只不同企业的股票，pe做比较是没有意义的，应该和股票自己历史上的pe水平比较，根据时间和涨跌归一化之后在比较，同行业内的股票，pe也可以比较。所以按照时间计算capm中的beta，对每只股票按照时间，结合beta，归一化，衍生出使得股票于股票之间可以比较的变量。行业内，可以行业内归一化，这样变量的数量就多了两倍。

衍生变量确实对于预测股票未来三个月和一年的涨跌，有一定的效果。但是效果依然十分不稳定，主要是由于，变量的效果经常出现反转，在某一段时间效果是排序是正的，下一年效果完全相反，看到这种结果简直想哭，我太难了。最后无奈采取迁移学习的方法，先取出要预测的当月的数据，从历史样本中用gan网络，选出和当月数据接近的数据，然后用这些数据训练一个模型，对当月最新数据打分，时间效果确实好了很多，而且不存在风格转换的问题，因为随着gan网络选择出的样本不同，每个月训练出来的模型效果也不一样。

其中预测未来一年的涨跌效果更加好，但是交易起来股票比较少，一个月预测效果不好。现在选取13-19年，每三月排序最好的20只股票进行交易回测，每三个月调仓一次，代码和效果如下：
可以看到，收益率其实每年都可以跑赢指数，虽然跑赢的不多。